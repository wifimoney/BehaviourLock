<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BehaviourLock Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            bg:      { DEFAULT: '#0f1117', card: '#1a1d2e', hover: '#242842' },
            accent:  { DEFAULT: '#6366f1', light: '#818cf8' },
            safe:    '#22c55e',
            risky:   '#f59e0b',
            blocked: '#ef4444',
          }
        }
      }
    }
  </script>

  <!-- Cytoscape.js for call graph -->
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
  <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>

  <!-- highlight.js for code blocks -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>

  <!-- diff2html for diffs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/diff2html/3.4.48/bundles/css/diff2html.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/diff2html/3.4.48/bundles/js/diff2html-ui-slim.min.js"></script>

  <link rel="stylesheet" href="/css/app.css">
</head>
<body class="bg-bg text-gray-200 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="border-b border-gray-800 px-6 py-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 rounded-lg bg-accent flex items-center justify-center font-bold text-white text-sm">BL</div>
      <h1 class="text-xl font-semibold text-white">BehaviourLock</h1>
      <span class="text-xs text-gray-500 ml-2">AI Migration Copilot</span>
    </div>
    <div class="flex items-center gap-3">
      <span id="health-dot" class="w-2.5 h-2.5 rounded-full bg-gray-600"></span>
      <span id="health-text" class="text-xs text-gray-500">Connecting...</span>
      <span id="session-badge" class="hidden text-xs bg-bg-card border border-gray-700 rounded px-2 py-0.5 font-mono"></span>
    </div>
  </header>

  <!-- Tab Navigation -->
  <nav id="tab-nav" class="border-b border-gray-800 px-6 flex gap-1 overflow-x-auto">
    <button class="tab-btn active" data-tab="ingest">Ingest</button>
    <button class="tab-btn" data-tab="pipeline" disabled>Pipeline</button>
    <button class="tab-btn" data-tab="report" disabled>Report</button>
    <button class="tab-btn" data-tab="graph" disabled>Call Graph</button>
    <button class="tab-btn" data-tab="dead-code" disabled>Dead Code</button>
    <button class="tab-btn" data-tab="tests" disabled>Tests</button>
    <button class="tab-btn" data-tab="baseline" disabled>Baseline</button>
    <button class="tab-btn" data-tab="diff" disabled>Migration Diff</button>
    <button class="tab-btn" data-tab="validation" disabled>Validation</button>
  </nav>

  <!-- Main Content -->
  <main class="flex-1 p-6 max-w-7xl mx-auto w-full">

    <!-- Ingest Section -->
    <section id="sec-ingest" class="tab-section">
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Local Path Card -->
        <div class="bg-bg-card rounded-xl border border-gray-800 p-6">
          <h2 class="text-lg font-semibold text-white mb-4">Local Path</h2>
          <div class="space-y-4">
            <div>
              <label class="block text-sm text-gray-400 mb-1">Repository path</label>
              <input id="ingest-path" type="text" placeholder="/path/to/legacy/repo"
                     class="w-full bg-bg border border-gray-700 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-600 focus:border-accent focus:outline-none">
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-1">Target module <span class="text-gray-600">(optional)</span></label>
              <input id="ingest-module" type="text" placeholder="payment_processor"
                     class="w-full bg-bg border border-gray-700 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-600 focus:border-accent focus:outline-none">
            </div>
            <button id="btn-ingest-path" class="btn-primary w-full">Ingest from Path</button>
          </div>
        </div>

        <!-- Upload Zip Card -->
        <div class="bg-bg-card rounded-xl border border-gray-800 p-6">
          <h2 class="text-lg font-semibold text-white mb-4">Upload Zip</h2>
          <div id="drop-zone" class="border-2 border-dashed border-gray-700 rounded-lg p-8 text-center cursor-pointer hover:border-accent transition-colors">
            <div class="text-gray-400 mb-2">
              <svg class="w-10 h-10 mx-auto mb-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
              </svg>
              Drop .zip here or click to browse
            </div>
            <input id="file-input" type="file" accept=".zip" class="hidden">
          </div>
          <div id="upload-info" class="hidden mt-3 text-sm text-gray-400"></div>
        </div>
      </div>

      <!-- Demo Shortcut -->
      <div class="mt-6 text-center">
        <div class="inline-flex items-center gap-3 bg-bg-card border border-gray-800 rounded-xl px-6 py-4">
          <span class="text-sm text-gray-400">Quick start:</span>
          <button id="btn-demo" class="btn-accent">Load Demo Project</button>
        </div>
      </div>
    </section>

    <!-- Pipeline Section -->
    <section id="sec-pipeline" class="tab-section hidden">
      <div class="bg-bg-card rounded-xl border border-gray-800 p-6">
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-lg font-semibold text-white">Pipeline Execution</h2>
          <button id="btn-run-pipeline" class="btn-primary">Run Pipeline</button>
        </div>

        <!-- Stage Stepper -->
        <div id="stepper" class="flex items-center justify-between">
          <div class="step" data-step="ingest">
            <div class="step-circle">1</div>
            <div class="step-label">Ingest</div>
          </div>
          <div class="step-line"></div>
          <div class="step" data-step="mining">
            <div class="step-circle">2</div>
            <div class="step-label">Mining</div>
          </div>
          <div class="step-line"></div>
          <div class="step" data-step="dead_code">
            <div class="step-circle">3</div>
            <div class="step-label">Dead Code</div>
          </div>
          <div class="step-line"></div>
          <div class="step" data-step="testgen">
            <div class="step-circle">4</div>
            <div class="step-label">TestGen</div>
          </div>
          <div class="step-line"></div>
          <div class="step" data-step="baseline">
            <div class="step-circle">5</div>
            <div class="step-label">Baseline</div>
          </div>
          <div class="step-line"></div>
          <div class="step" data-step="migration">
            <div class="step-circle">6</div>
            <div class="step-label">Migration</div>
          </div>
          <div class="step-line"></div>
          <div class="step" data-step="validation">
            <div class="step-circle">7</div>
            <div class="step-label">Validation</div>
          </div>
          <div class="step-line"></div>
          <div class="step" data-step="report">
            <div class="step-circle">8</div>
            <div class="step-label">Report</div>
          </div>
        </div>

        <div id="pipeline-status" class="mt-8 text-center text-gray-500 text-sm">
          Ready to run. Click "Run Pipeline" to start.
        </div>
      </div>
    </section>

    <!-- Report Section -->
    <section id="sec-report" class="tab-section hidden"></section>

    <!-- Call Graph Section -->
    <section id="sec-graph" class="tab-section hidden">
      <div class="bg-bg-card rounded-xl border border-gray-800 p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-lg font-semibold text-white">Call Graph</h2>
          <div class="flex items-center gap-2">
            <button id="graph-zoom-in" class="btn-sm">+</button>
            <button id="graph-zoom-out" class="btn-sm">-</button>
            <button id="graph-fit" class="btn-sm">Fit</button>
          </div>
        </div>
        <!-- Legend -->
        <div class="flex gap-4 text-xs text-gray-400 mb-3">
          <span><span class="inline-block w-3 h-3 rounded bg-green-500 mr-1"></span>Entrypoint</span>
          <span><span class="inline-block w-3 h-3 rounded bg-blue-500 mr-1"></span>Function</span>
          <span><span class="inline-block w-3 h-3 rounded bg-orange-500 mr-1"></span>Side Effect</span>
          <span class="ml-2">Edges: solid=direct, dashed=conditional, dotted=loop</span>
        </div>
        <div id="cy-container" class="w-full h-[500px] rounded-lg bg-bg"></div>
        <!-- Node detail panel -->
        <div id="node-detail" class="hidden mt-3 bg-bg rounded-lg border border-gray-700 p-4">
          <h3 id="node-detail-name" class="font-semibold text-white"></h3>
          <div id="node-detail-body" class="text-sm text-gray-400 mt-1"></div>
        </div>
      </div>
    </section>

    <!-- Dead Code Section -->
    <section id="sec-dead-code" class="tab-section hidden"></section>

    <!-- Tests Section -->
    <section id="sec-tests" class="tab-section hidden"></section>

    <!-- Baseline Section -->
    <section id="sec-baseline" class="tab-section hidden"></section>

    <!-- Migration Diff Section -->
    <section id="sec-diff" class="tab-section hidden"></section>

    <!-- Validation Section -->
    <section id="sec-validation" class="tab-section hidden"></section>

  </main>

  <!-- Toast Container -->
  <div id="toast-container" class="fixed bottom-6 right-6 flex flex-col gap-2 z-50"></div>

  <!-- JS Modules -->
  <script src="/js/api.js"></script>
  <script src="/js/state.js"></script>
  <script src="/js/components/tabs.js"></script>
  <script src="/js/components/toast.js"></script>
  <script src="/js/sections/ingest.js"></script>
  <script src="/js/sections/pipeline.js"></script>
  <script src="/js/sections/report.js"></script>
  <script src="/js/sections/graph.js"></script>
  <script src="/js/sections/deadcode.js"></script>
  <script src="/js/sections/tests.js"></script>
  <script src="/js/sections/baseline.js"></script>
  <script src="/js/sections/diff.js"></script>
  <script src="/js/sections/validation.js"></script>
  <script src="/js/main.js"></script>
</body>
</html>
